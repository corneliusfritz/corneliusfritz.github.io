<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>What JavaScript Tests Could Learn From RSpec - Artsy Engineering</title>
  <meta name="author" content="">

  
  <meta name="description" content="When I started at Artsy a few years ago, I'd never written a line of Ruby. I feel at home with JavaScript — it's
been my buddy since I started my c...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:image" content="http://artsy.github.io/images/artsy_oss_image.png" />
  <meta property="og:image:type" content="image/png" />

  
  <link rel="canonical" href="https://www.stevenhicks.me/blog/2021/09/what-javascript-tests-could-learn-from-rspec/">
  <link rel="alternate" type="application/rss+xml" title="Artsy Engineering Blog" href="/feed">
  <link rel="alternate" type="application/atom+xml" title="Podcast Feed" href="/podcast.xml" />

  <link href="/favicon.ico" rel="icon">
  <link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  <script src="/javascripts/jquery-1.11.3.min.js"> </script>
  <script src="/javascripts/gradient-fade.js"></script>
  <script src="/javascripts/noframework.waypoints.min.js"></script>
  <script src="/javascripts/sticky.min.js"></script>
  <script src="/javascripts/search.min.js"></script>
  <script src="/javascripts/custom-element.min.js"></script>
  <script src="/javascripts/g-emoji-element.js"></script>

  

  <script type="text/javascript" src="https://fast.fonts.net/jsapi/f7f47a40-b25b-44ee-9f9c-cfdfc8bb2741.js"></script>


  <link href="/feed.xml" rel="alternate" title="Artsy Engineering" type="application/atom+xml">
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12450662-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <!--[if IE 8]><link href="/stylesheets/custom/ie_font.css" type="text/css"><![endif]-->

</head>


<link href="/css/epic.css" media="screen, projection" rel="stylesheet" type="text/css">



<body>
  <div>
    <div id="bodywrapper">
      <header>
        <ul>
          <li><a href="/">Artsy Engineering Blog</a></li>
          <li><a href="https://www.artsy.net/jobs">Careers</a></li>
          <li><a href="https://developers.artsy.net">API</a></li>
        </ul>

        <ul>
          <li><a href="http://artsy.github.io/open-source/">Our Open Source</a></li>
          <li><a href="http://twitter.com/artsyopensource">@artsyopensource</a></li>
          <li><a href="https://www.artsy.net">artsy.net</a></li>
        </ul>
      </header>

      <section>
        <header id="page">
          <h1>What JavaScript Tests Could Learn From RSpec</h1>
          <h3>
          <!-- Yep, single line so the comma lines up right -->
          By  Steve Hicks
          </h3>
          <time datetime="2021-09-10">Sep 10, 2021</time>
        </header>

        <article class='post'>
          <p>When I started at Artsy a few years ago, I'd never written a line of Ruby. I feel at home with JavaScript — it's
been my buddy since I started my career over 20 years ago. I've written enough tests in JavaScript that I sometimes
feel like I can write them in my sleep (as long as they don't involve async React events 😅).</p>

<p>Most of the code I write at Artsy is still JavaScript, but now I write some Ruby code too, and I've written enough
RSpec tests that I'm starting to form opinions about what I think they should look like.</p>

<p>My most recent work has been JavaScript again. I've been writing Jest tests against one of our React apps. But
rather than reaching for the testing patterns I'd become accustomed to over my years of JavaScripting, I'm finding
that something's missing in my Jest tests! My experiences with RSpec have me longing for two features in Jest:</p>

<!-- more -->


<ol>
<li><code>context</code> blocks</li>
<li><code>let</code> blocks</li>
</ol>


<a name="L1...code.context..code..blocks"></a>
<h2>1. <code>context</code> blocks</h2>

<p>A <a href="https://relishapp.com/rspec/rspec-core/v/2-11/docs/example-groups/basic-structure-describe-it"><code>context</code> block</a>
in an RSpec test is, as I understand it, literally the same thing as a <code>describe</code> block. Like it's just an alias of
<code>describe</code>. What's the point, you ask?</p>

<p>The difference is in, well, context. Well-organized RSpec tests use <code>describe</code> to describe what's being
tested...and <code>context</code> to describe scenarios of the thing being tested.</p>

<p>For example, if I wanted to test the <code>multiply</code> method of a <code>Calculator</code> class, I might write some test scenarios
that look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">describe</span> <span class="s2">&quot;Calculator&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;.multiply&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">context</span> <span class="s2">&quot;when the first value is negative&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">context</span> <span class="s2">&quot;when the second value is negative&quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">it</span> <span class="s2">&quot;returns a positive number&quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">context</span> <span class="s2">&quot;when the second value is positive&quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">it</span> <span class="s2">&quot;returns a negative number&quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>See the difference in those test cases between <code>describe</code> and <code>context</code>? The way I think about it is: if the
statement coming after my <code>describe</code>/<code>context</code> describes a pre-condition for the test, it's a <code>context</code>; otherwise
it's a <code>describe</code>.</p>

<p><code>context</code> wouldn't be hard to implement in JavaScript — I'd bet there are test frameworks that have it. It'd just
be an alias of <code>describe</code>.</p>

<a name="L2...code.let..code..blocks"></a>
<h2>2. <code>let</code> blocks</h2>

<p><a href="https://relishapp.com/rspec/rspec-core/v/2-11/docs/helper-methods/let-and-let"><code>let</code> blocks</a> are used in an RSpec
test to set things up for your test scenario.</p>

<p>Here's a test for a <code>Counter</code> class, verifying that when I call the <code>increment</code> method on an instance, its stored
value becomes <code>1</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">describe</span> <span class="s2">&quot;counter&quot;</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">let</span><span class="p">(</span><span class="ss">:counter</span><span class="p">)</span> <span class="p">{</span> <span class="no">Counter</span><span class="o">.</span><span class="n">new</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;increment&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;increments by 1&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">counter</span><span class="o">.</span><span class="n">increment</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">counter</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you're new to Ruby, the only line that doesn't translate almost directly to a similar JavaScript expression is
the <code>let</code> statement.</p>

<p>The <code>let</code> statement in RSpec <a href="https://medium.com/@tomkadwill/all-about-rspec-let-a3b642e08d39">creates a method with a specified name, which lazily evaluates to the result of a
block</a>. In this case, we get a method named <code>counter</code>, which is evaluated to a new instance of the
<code>Counter</code> class. There are a few important things to note about <code>let</code> blocks:</p>

<ol>
<li>They're evaluated lazily (by default). That <code>counter</code> doesn't actually get created until I reference it.</li>
<li>They're memoized. Wherever I reference <code>counter</code> within that <code>describe "counter"</code> block, I'm getting the same
instance. It's initialized to whatever I return inside the <code>let</code> block.</li>
<li>I can override a <code>let</code> block deeper inside the tree of tests, by declaring another <code>let(:counter)</code> later. When I
do this, the closest <code>let</code> block in the tree for that thing is the one that gets used.</li>
</ol>


<p>I don't think it's possible to implement <code>let</code> in JavaScript — at least not in the way it exists in RSpec. It
relies on
<a href="https://www.leighhalliday.com/ruby-metaprogramming-method-missing">Ruby meta-programming to intercept calls to missing methods</a>,
which just doesn't exist in JavaScript. The <a href="https://github.com/enova/givens">givens</a> library does something pretty
close, but it relies on string keys to define things, and there's a bit of extra work when working with TypeScript.</p>

<a name="What.s.the.big.deal."></a>
<h2>What's the big deal?</h2>

<p>On the surface these two features don't seem like much, but they provide a really powerful framework for organizing
test cases and the associated test setup.</p>

<p>With the <code>let</code> blocks being lazily evaluated, and override-able, I can set up data at the exact level of tests that
I need it. When I need to override it for a certain set of tests, I can put another <code>let</code> block in that set. In
JavaScript I can define functions to set up my data for me with just the changes I need at each test level, or I
can use <code>beforeEach</code> blocks, but all that can get pretty noisy.</p>

<p>And with <code>context</code> blocks, I can more clearly lay out the scenarios of my tests. Yes, I <em>could</em> just do this with
more <code>describe</code> blocks in JavaScript, but how often have you found JavaScript tests that actually do this? I've
personally seen/written too many tests to count named something like
<code>it("returns false when the flag is enabled, they're located in the US, but they have brown hair.")</code>. That's three
scenarios rolled into one test name. It works, but being able to nest different <code>context</code> blocks to define my
complex scenarios is much easier to read.</p>

<a name="Examples"></a>
<h2>Examples</h2>

<p>Here's an example of some tests I could write in RSpec with <code>let</code> and <code>context</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">describe</span> <span class="s2">&quot;Calculator&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">let</span><span class="p">(</span><span class="ss">:calculator</span><span class="p">)</span> <span class="p">{</span> <span class="no">Calculator</span><span class="o">.</span><span class="n">new</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;.multiply&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">let</span><span class="p">(</span><span class="ss">:result</span><span class="p">)</span> <span class="p">{</span> <span class="n">calculator</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">context</span> <span class="s2">&quot;when the first value is negative&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">let</span><span class="p">(</span><span class="ss">:first</span><span class="p">)</span> <span class="p">{</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">context</span> <span class="s2">&quot;when the second value is negative&quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">let</span><span class="p">(</span><span class="ss">:second</span><span class="p">)</span> <span class="p">{</span> <span class="o">-</span><span class="mi">3</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">it</span> <span class="s2">&quot;returns a positive number&quot;</span> <span class="k">do</span>
</span><span class='line'>          <span class="n">result</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">context</span> <span class="s2">&quot;when the second value is positive&quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">let</span><span class="p">(</span><span class="ss">:second</span><span class="p">)</span> <span class="p">{</span> <span class="mi">3</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">it</span> <span class="s2">&quot;returns a negative number&quot;</span> <span class="k">do</span>
</span><span class='line'>          <span class="n">result</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>HOW COOL IS THAT! Every <code>describe</code>/<code>context</code> block has <em>exactly</em> the setup data it needs defined clearly inside it.
And each block has very little noise to distract you.</p>

<p>Here's what I'd do in JavaScript/Jest to accomplish something similar:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='JavaScript'><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;Calculator&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">let</span> <span class="nx">calculator</span>
</span><span class='line'>  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">calculator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Calculator</span><span class="p">()</span> <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;.multiply&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">let</span> <span class="nx">first</span><span class="p">,</span> <span class="nx">second</span>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">getResult</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">calculator</span><span class="p">.</span><span class="nx">multiply</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">second</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;when the first value is negative&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">first</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;when the second value is negative&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">second</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;returns a positive number&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">expect</span><span class="p">(</span><span class="nx">getResult</span><span class="p">()).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;when the second value is positive&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">second</span> <span class="o">=</span> <span class="mi">3</span> <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;returns a negative number&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">expect</span><span class="p">(</span><span class="nx">getResult</span><span class="p">()).</span><span class="nx">toEqual</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>There's definitely a bit more noise here, especially with the <code>beforeEach</code> and <code>let</code> statements. It's not a <em>lot</em>
more noise, but it is definitely more noise.</p>

<p>In real life I wouldn't expect to find tests like the above JavaScript example. I'd expect to find the tests in
JavaScript looking more like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='JavaScript'><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;Calculator&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">let</span> <span class="nx">calculator</span>
</span><span class='line'>  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">calculator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Calculator</span><span class="p">()</span> <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;.multiply&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;returns a positive number when the first number is negative and the second number is negative&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">calculator</span><span class="p">.</span><span class="nx">multiply</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;returns a negative number when the first number is negative and the second number is positive&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">calculator</span><span class="p">.</span><span class="nx">multiply</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>You could certainly make the case for this contrived example that <em>this</em> is actually the most readable set of
tests, because there's less code. I would have a hard time arguing. But most real-life tests are more complex than
these examples, with state and side-effects to mock out, and more scenarios and edge cases worth testing. Each test
case here includes multiple conditions, but there are only two permutations represented. Once things get a little
more complicated than these contrived examples, the RSpec tests become the clear winner for me — they're easier to
read and manage, with their <code>let</code> and <code>context</code> blocks more discretely describing your test scenarios.</p>

<p>You could also argue that the bigger win here would be breaking scenarios into individual <code>describe</code> blocks in
JavaScript tests, instead of cramming the entire scenario into one long <code>it("...")</code> statement. I wouldn't argue
that either.</p>

<a name="Caveats"></a>
<h2>Caveats</h2>

<p>The day after I wrote this article, a conversation started in the Artsy slack about how confusing <code>let</code> was because
it moved variable initializations far away from where the tests used them.</p>

<p>This makes sense! I think it points to two truths in software development:</p>

<a name="Code.readability.is.subjective"></a>
<h3>Code readability is subjective</h3>

<p>For years I was convinced that practices like small functions or long and descriptive function names were
<em>objectively</em> more readable. I leaned into this, and my code reviews almost always included comments on what I
thought would make the code more readable.</p>

<p>As more people pushed back on my feedback over time, I realized that the feedback I was giving was <em>subjective</em>. I
still like code that uses many short functions wired together, but not everyone finds that more readable! I've
stopped giving readability feedback on PRs, unless I can provide nearly-objective facts or scenarios that point to
a readability improvement.</p>

<p>In this article, I find the RSpec <code>let</code> examples to be much more readable than the JavaScript examples. But you and
your team might not! Maybe the distance between a <code>let</code> block's definition and its method's usage makes it hard for
you to follow the test. That's cool!</p>

<a name="Any.cool.thing.can.be.abused"></a>
<h3>Any cool thing can be abused</h3>

<p>Earlier in this article I linked to <a href="https://medium.com/@tomkadwill/all-about-rspec-let-a3b642e08d39">an article that describes <code>let</code> blocks in more detail</a>. It includes
<a href="https://www.rubydoc.info/github/rspec/rspec-core/RSpec%2FCore%2FMemoizedHelpers%2FClassMethods%3Alet">a warning from the actual <code>let</code> docs</a>:</p>

<blockquote><p>Note: <code>let</code> can enhance readability when used sparingly (1,2, or maybe 3 declarations) in any given example
group, but that can quickly degrade with overuse. YMMV.</p></blockquote>

<p>I've definitely seen code where I had a hard time following a stream of <code>let</code> blocks. The RSpec example I gave
above reads nicely to me — but it's probably teetering on the edge of where <code>let</code> usage becomes confusing. I'm
guessing I have a slightly higher tolerance for this particular abstraction than my friends who don't like
it...again pointing to readability being subjective.</p>

<p>Having said all that — lately every time I try to write JavaScript tests, I find myself trying (unsuccessfully) to
recreate that RSpec example above. It represents exactly how I want to think about complex test scenarios. Each
level of the tests has exactly the setup that is unique to that level. There's very little distraction or noise at
each <code>context</code> and <code>it</code>. It totally aligns with
<a href="https://www.stevenhicks.me/blog/2018/01/chekhovs-gun-and-better-unit-tests/">my desire to minimize irrelevant test setup</a>.
I'm in ❤️ ❤️ ❤️ ❤️ ❤️.</p>

<blockquote><p><em>This post originally appeared on
<a href="https://www.stevenhicks.me/blog/2021/09/what-javascript-tests-could-learn-from-rspec/">Steve's blog</a>.</em></p></blockquote>

        </article>

        <article class='post'>
          <p style="padding-bottom: 0; margin-bottom:0;">
            <a href="https://www.artsy.net/" style="background-image: none;">
              <svg viewBox="0 0 510 510" width="40" height="40" xmlns="http://www.w3.org/2000/svg">
                <path transform="scale(1, -1) translate(0, -480)" d="M0 -32h512v512h-512v-512v0zM464 16h-80v80h-48v-80h-288v416h416v-416v0zM194 384h-40l-74 -186h38l20 52h72l19 -52h39l-74 186v0zM149 282l25 66l24 -66h-49v0z"></path>
              </svg>
            </a>
          <p/>
        </article>

      
        <article class='post'>
          <section id="comments" />

<script type="text/javascript">
  // Comes from https://stackoverflow.com/questions/3177836/how-to-format-time-since-xxx-e-g-4-minutes-ago-similar-to-stack-exchange-site
  function timeSince(date) {
    var seconds = Math.floor((new Date() - date) / 1000)
    var interval = Math.floor(seconds / 31536000)

    if (interval > 1) {
      return interval + " years"
    }
    interval = Math.floor(seconds / 2592000)
    if (interval > 1) {
      return interval + " months"
    }
    interval = Math.floor(seconds / 86400)
    if (interval > 1) {
      return interval + " days"
    }
    interval = Math.floor(seconds / 3600)
    if (interval > 1) {
      return interval + " hours"
    }
    interval = Math.floor(seconds / 60)
    if (interval > 1) {
      return interval + " minutes"
    }
    return Math.floor(seconds) + " seconds"
  }

  var writeToComment = function (element, html) {
    var element = document.createElement(element)
    element.innerHTML = html
    document.getElementById("comments").appendChild(element)
  }

  var addReactions = function (reactions, link) {
    var returnString = ""
    var emojiCode = {
      '+1': "<g-emoji alias='+1' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f44d.png' class='emoji'>👍</g-emoji>",
      '-1': "<g-emoji alias='-1' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f44e.png' class='emoji'>👎</g-emoji>",
      laugh: "<g-emoji alias='smile' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f604.png' class='emoji'>😄</g-emoji>",
      hooray: "<g-emoji alias='tada' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f389.png' class='emoji'>🎉</g-emoji>",
      confused: "<g-emoji alias='thinking_face' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f615.png' class='emoji'>😕</g-emoji>",
      heart: "<g-emoji alias='framed_picture' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f5bc.png' class='emoji'>🖼</g-emoji>"
    }

    if (reactions.total_count > 0) {
      returnString += "<div class='comment-reactions'>"
      for (var key in reactions) {
        if (reactions.hasOwnProperty(key)) {
          if (reactions[key] > 0 && key !== "total_count") {
            returnString += "<a href='" + link + "' class='emoji-wrapper'>" + emojiCode[key] + reactions[key] + "</a>"
          }
        }
      }
      returnString += "</div>"
      return returnString
    } else {
      return "<div></div>"
    }
  }

  // Based on http://ivanzuzak.info/2011/02/18/github-hosted-comments-for-github-hosted-blogs.html
  // And http://donw.io/post/github-comments/

  var loadComments = function (data) {
    writeToComment("h2", "Comments")
    for (var i = 0; i < data.length; i++) {
      var cuser = data[i].user.login
      var cuserlink = data[i].user.html_url
      var clink = data[i].html_url
      var cbody = data[i].body_html
      var cavatarlink = data[i].user.avatar_url
      var cdate = new Date(data[i].created_at)
      var creactions = addReactions(data[i].reactions, clink)

      var commentHTML =
        "<div class='comment'>" +
        "<div class='comment-header'>" +
        "<a class='comment-username' href=\"" + cuserlink + '">' +
        '<img src="' + cavatarlink + '" alt="" width="40" height="40">' +
        cuser +
        "</a>" + " commented " +
        "<a class='comment-date' href=\"" + clink + '">' +
        timeSince(cdate) + " ago" +
        "</a>" +
        "</div>" +
        "<div class='comment-body'>"
        + cbody +
        "</div>" +
        creactions +
        "</div>"
      writeToComment("div", commentHTML)
    }

    var callToAction =
      "<hr/>" +
      "<p>" +
      "Our comments are using GitHub Issues on the Artsy Blog repo. You can post by replying to <a href='https://github.com/artsy/artsy.github.io/issues/701'>issue #701</a>." +
      "</p>"
    writeToComment("div", callToAction)
  }

  var writeFirstComment = function () {
    var callToAction =
      "<hr/>" +
      "<p>" +
      "This post has no comments, yet, you could be the first. Our comments are using GitHub Issues on the Artsy Blog repo. You can post by replying to <a href='https://github.com/artsy/artsy.github.io/issues/701'>issue #701</a>." +
      "</p>"
    writeToComment("div", callToAction)
  }

  if (window.fetch) {
    var url =
      "https://artsy-blog-gh-commentify.herokuapp.com/repos/artsy/artsy.github.io/issues/701/comments"
    window
      .fetch(url, { Accept: "application/vnd.github.v3.html+json" })
      .then(function (response) {
        return response.json()
      })
      .then(function (json) {
        if (json.length) {
          loadComments(json)
        } else {
          writeFirstComment()
        }
      })
  }

</script>
        </article>
      

      </section>

      <footer>
        <article>

          <section>
            <h4>Author</h4>
            <p> <a href="/author/steve-hicks"/>Steve Hicks</a></p>
            <p></a></p>
          </section>

          <section>
            <h4>Post Meta</h4>
            <p>Sep 10, 2021</p>
            <p>Tagged: <a class='category' href='/blog/categories/jest/'>jest</a>, <a class='category' href='/blog/categories/rspec/'>rspec</a>, <a class='category' href='/blog/categories/testing/'>testing</a></p>
          </section>
          <br/>
          <section>
            <h4>Artsy OSS</h4>
            <ul>
              <li><a href='https://www.artsy.net'>Artsy.net</a></li>
              <li><a href='https://developers.artsy.net'>API</a></li>
              <li><a href='http://artsy.github.io/open-source/'>Featured OSS</a></li>
              <li><a href='https://www.artsy.net/jobs'>Careers</a></li>
            </ul>
          </section>

          <section>
            <h4>Blog</h4>
            <ul>
              <li><a href='http://artsy.github.io/blog/archives/'>Archives</a></li>
              <li><a href='http://artsy.github.io/search/'>Search</a></li>
              <li><a href='https://github.com/artsy/artsy.github.io'>Code on GitHub</a></li>
              <li><a href='https://github.com/artsy/artsy.github.io/edit/source/_posts/2021-09-07-what-javascript-tests-could-learn-from-rspec.md'>Fix typoes in this post</a></li>
            </ul>
          </section>

        </article>

        <article>
          <section>
            <h4>Post Series on the Blog</h4>
            <ul>
              
              <li><a href='/series/react-native-at-artsy/'>React Native at Artsy</a></li>
              
              <li><a href='/series/javascriptures/'>JavaScriptures</a></li>
              
              <li><a href='/series/stages-of-professional-growth/'>Stages of Professional Growth</a></li>
              
              <li><a href='/series/artsy-tech-stack/'>Artsy Tech Stack</a></li>
              
              <li><a href='/series/open-source-by-default/'>Open Source by Default</a></li>
              
            </ul>
          </section>

          <section>
          
          </section>
        </article>

      </footer>
    </div>
  </div>
</body>
